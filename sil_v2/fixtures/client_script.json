[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Issue",
  "enabled": 1,
  "modified": "2025-06-16 09:52:58.944247",
  "module": "Sil V2",
  "name": "Issue",
  "script": "frappe.ui.form.on('Issue', {\n    refresh(frm) {\n        // Always make issue status read-only\n        frm.set_df_property('custom_issue_status', 'read_only', 1);\n        frm.refresh_field('custom_issue_status');\n\n        // Apply color based on current value\n        style_custom_issue_status(frm);\n    },\n    \n    custom_item_serial_nos: function(frm){\n        if (frm.doc.custom_item_serial_nos) {\n            console.log(\"Hiii\")\n        frappe.call({\n            method: \"sil_v2.services.api.get_item_details_from_serial_no\",\n            args: {\n                serial_no: frm.doc.custom_item_serial_nos\n            },\n            callback: function(r) {\n                if (r.message) {\n                    let item_details = r.message\n                    frm.set_value('custom_item_classification', item_details.custom_item_classification);\n                    frm.set_value('custom_item', item_details.item);\n                    frm.set_value('custom_item_name', item_details.custom_item_name);\n                    frm.set_value('customer', item_details.customer);\n                    frm.set_value('custom_city_or_town', item_details.city_or_town);\n                    frm.set_value('custom_customer_address', item_details.full_address);\n                  \n\n                } else {\n                    frappe.msgprint(\"No Details found for this Serial No\");\n                }\n            }\n            \n        });\n    }\n    else{\n        const fields = [\"custom_item_classification\",\"custom_item\",\"custom_item_name\",\"customer\"]\n        for(let field of fields){\n            frm.set_value( field, \"\");\n        }\n    }\n    },\n    customer: function(frm) {\n        if (frm.doc.customer) {\n            frappe.call({\n                method: \"sil_v2.services.api.get_customer_addresses\",\n                args: {\n                    customer: frm.doc.customer\n                },\n                callback: function(r) {\n                    if (r.message && r.message.length > 0) {\n                        let address = r.message[0].full_address;\n                        frm.set_value('custom_customer_address', address);\n                        frm.set_value('custom_city_or_town', r.message[0].city_or_town);\n                          frm.refresh_field('custom_city_or_town');\n                        console.log(r.message[0].city_or_town)\n                        \n                    } else {\n                        frappe.msgprint(\"No address found for this customer.\");\n                    }\n                }\n            });\n        }\n        else{\n            frm.set_value('custom_customer_address', \"\");\n            frm.set_value('custom_city_or_town', \"\");\n        }\n    },\n    \n    \n    custom_service_status_: function (frm) {\n        // Sync logic when service status is changed\n        if (frm.doc.custom_service_status_ === 'Resolved') {\n            frm.set_value('custom_issue_status', 'Resolved');\n        }\n        else {\n            frm.set_value('custom_issue_status', 'Open');\n        }\n\n        // Refresh and apply styles\n        frm.refresh_field('custom_issue_status');\n        style_custom_issue_status(frm);\n    }\n});\n\nfunction style_custom_issue_status(frm) {\n    setTimeout(() => {\n        const field = frm.get_field('custom_issue_status');\n        if (field && field.$wrapper) {\n            const value = frm.doc.custom_issue_status;\n\n            // Default styling\n            let background = '#e8f0fe'; // fallback\n            if (value === 'Resolved') {\n                background = '#e6f4ea'; // pale green\n            }\n\n            field.$wrapper.find('.control-value').css({\n                'background-color': background,\n                'padding': '4px 8px',\n                'border-radius': '20px',\n                'width': 'fit-content',\n                'display': 'inline-block',\n                'color': 'black'\n            });\n        }\n    }, 100);\n}\n",
  "view": "Form"
 }
]